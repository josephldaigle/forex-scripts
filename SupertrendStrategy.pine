//@version=5
strategy("Supertrend Strategy", overlay=true, default_qty_type=strategy.percent_of_equity, default_qty_value=15)

licenseId = "5997022937301"
riskValue = input.int(1, 'Risk Value')
factor = input.float(3.5, "Factor", step = 0.01)
atrPeriod = input(9, "ATR Length")
maPeriod = input.int(50, "MA Period (pips)")

// compute the moving average across maPeriod
ma = ta.ema(close, maPeriod)

[trend, direction] = ta.supertrend(factor, atrPeriod)

plot(direction < 0 ? trend : na, title = "Up direction", color = color.green, style=plot.style_linebr)
plot(direction > 0 ? trend : na, title = "Down direction", color = color.red, style=plot.style_linebr)

if ta.change(direction) < 0
    alert(licenseId + ',buy,' + syminfo.ticker + ',risk=' + str.tostring(riskValue) + ',signal=supertrend_long_entry, sl=' + str.tostring(trend), alert.freq_once_per_bar_close)
    strategy.entry("long_entry", strategy.long)
    strategy.close("short_entry")
    
if ta.change(direction) > 0
    alert(licenseId + ',sell,' + syminfo.ticker + ',risk=' + str.tostring(riskValue) + ',signal=supertrend_short_entry, sl=' + str.tostring(trend), alert.freq_once_per_bar_close)
    strategy.entry("short_entry", strategy.short)
    strategy.close("long_entry")


// plot the moving average as an orange line
plot(ma, color = color.orange, title = "MA")